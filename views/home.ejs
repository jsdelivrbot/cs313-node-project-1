<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <!-- <link rel="stylesheet" href="/css/main.css"> -->
    <title>Home | Card Games</title>
    <!-- <script src="/js/call.js"></script> -->
</head>

<body>
    <div class="container">

        <h1>Card Games</h1>
        <div>
            <% for (var i = 0; i < result.length; i++) { %>
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h2>
                            <%= result[i].title %>
                        </h2>
                        <button onclick="makeCall(<%= result[i].gamesid %>)" class="btn btn-primary">Get Details</button>
                    </div>
                    <div class="panel-body">
                        <%= result[i].description %>
                    </div>
                </div>

                <% } %>
        </div>

        <!-- The Modal -->
        <div id="myModal" class="modal">

            <!-- Modal content -->
            <div class="modal-content">
                <span class="close">&times;</span>
                <h3 id="title"></h3>
                <p id="description"></p>
                <p id="instructions"></p>
                <p id="numOfPlayers"></p>
                <p id="numOfDecks"></p>
                <p id="timeLength"></p>
                <p id="relaxed"></p>
            </div>

        </div>

    </div>
    <script>
        // Get the modal
        var modal = document.getElementById('myModal');
        console.log(document.getElementById('myModal'));
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        console.log(span);
        // When the user clicks on <span> (x), close the modal
        span.onclick = function () {
            modal.style.display = "none";
        }

        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function (event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }

        function makeCall(id) {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    // console.log(this.responseText);
                    var json = JSON.parse(this.responseText);
                    modal.style.display = "block";
                    console.log(json);
                    document.getElementById('title').innerHTML = json.title;
                    document.getElementById('description').innerHTML = "Description: " + json.description;
                    document.getElementById('instructions').innerHTML = "Instructions: " + json.instructions;
                    document.getElementById('numOfPlayers').innerHTML = "Number of Players: " + json.numofplayers;
                    document.getElementById('numOfDecks').innerHTML = "Number of Decks: " + json.numofdecks;
                    document.getElementById('timeLength').innerHTML = "Time Length: " + json.timelength;
                    document.getElementById('relaxed').innerHTML = "Relaxed Game: " + json.relaxed;
                }
            };
            xhttp.open("GET", "/game/" + id, true);
            xhttp.send();
        }
    </script>
</body>

</html>